/* _____     _ _           ______ _                          ______ _  __ _
 *|  _  |   | (_)          | ___ \ |                         | ___ (_)/ _| |
 *| | | | __| |_ _ __  ___ | |_/ / | __ _ ___ _ __ ___   __ _| |_/ /_| |_| | ___
 *| | | |/ _` | | '_ \/ __||  __/| |/ _` / __| '_ ` _ \ / _` |    /| |  _| |/ _ \
 *\ \_/ / (_| | | | | \__ \| |   | | (_| \__ \ | | | | | (_| | |\ \| | | | |  __/
 * \___/ \__,_|_|_| |_|___/\_|   |_|\__,_|___/_| |_| |_|\__,_\_| \_|_|_| |_|\___|
 *
 *
 * jQuery Gavel Plugin
 * version: 1.1.0
 * Requires jQuery v1.7 or later
 * Copyright (c) 2015 Joshua van Besouw
 * Project repository: https://github.com/odinsplasmarifle/jquery.gavel
 * MIT License
 *
 * You can find me at https://github.com/odinsplasmarifle
 *
 */

!function(e,a){var r=function(e,r){this.element=e,this.$element=a(e),this.options=r,self=this};r.prototype={defaults:{errorText:!0,errorContainer:"span",errorClass:"gavelError",afterEach:null,afterAll:null,initiated:!1,validation:{alphanumeric:{message:"Only alphanumeric characters are permitted",regex:/^$|^(?=.*[A-Z0-9])[\w.,!"'-\/$ ]+$/i,method:null},numeric:{message:"Only numeric characters are permitted",regex:/^$|^\d+(\.\d{1,2})?$/,method:null},alphabetic:{message:"Only alphabetic characters are permitted",regex:/^$|^[a-zA-Z .-]+$/,method:null},email:{message:"Only valid email addresses are permitted",regex:/^$|^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,method:null},telephone:{message:"Only valid telephone numbers are permitted (eg. +27 00 000 0000)",regex:/\+(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\W*\d\W*\d\W*\d\W*\d\W*\d\W*\d\W*\d\W*\d\W*(\d{1,2})$/,method:null},date:{message:"Only valid dates are permitted (eg. dd-mm-yyyy)",regex:/^(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[1,3-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/,Method:null},required:{message:"This is a required field",regex:null,method:"validateRequired"},match:{message:"The fields must match",regex:null,method:"validateMatch"},min:{message:"The min characters permitted is {min}",regex:null,method:"validateMin"},max:{message:"The max characters permitted is {max}",regex:null,method:"validateMax"}},inputEvents:["keyup","change","blur"],formEvents:["submit"]},init:function(){self.config=a.extend(!0,{},self.defaults,self.options),self.attachHandlers()},attachHandlers:function(){a.each(self.config.inputEvents,function(e,r){a(self.element).on(r,"*[data-gavel]",function(e){self.initValidate(a(this))})}),a.each(self.config.formEvents,function(e,r){a(self.element).on(r,function(e){var r=self.initFormValidate(a(this));r.error&&e.preventDefault()})}),self.config.initiated=!0},initFormValidate:function(e){var r={error:!1,message:""};if(e.find("*[data-gavel]").each(function(){var e=self.initValidate(a(this));r.error||(r.error=e.error)}),null!==self.config.afterAll){var t=self.config.afterAll.call(self,r,e);"error"in t&&"message"in t&&(r.error=t.error)}return r},initValidate:function(e){e.attr("data-gavel-uid",self.getUid(e)),self.clearError(e);var a=self.validate(e);if(null!==self.config.afterEach){var r=self.config.afterEach.call(self,a,e);"error"in r&&"message"in r&&(a.error=r.error)}return a.error&&self.outPutError(e,a.message),a},getUid:function(e){var a=e.attr("data-gavel-uid");return a="undefined"!=typeof a&&""!==a?e.attr("data-gavel-uid"):self.generateUid()},generateUid:function(e){for(var r="";""===r||a('*[data-gavel][data-gavel-uid="'+r+'"]').length>1;)r=Math.random().toString(16).slice(2);return r},validate:function(e){var r={error:!1,message:""};if("undefined"!=typeof e&&"undefined"!=typeof e.data("gavel-rules")){var t=e.data("gavel-rules").split("|");a.each(t,function(a,t){if(t in self.config.validation&&"undefined"!=typeof self.config.validation[t].regex&&null!==self.config.validation[t].regex)e.val().match(self.config.validation[t].regex)||("undefined"!=typeof self.config.validation[t].message&&(r.message=self.config.validation[t].message),r.error=!0);else{var n=null,i=t.split("["),l=i[0],s=t.match(/^[a-zA-Z0-9 .-\_]+\[([^)]+)\]$/);s=s&&"undefined"!=typeof s[1]?s[1]:"",l in self.config.validation&&("string"==typeof self.config.validation[l].method?n=self[self.config.validation[l].method](e,s):l in self.config.validation&&"undefined"!=typeof self.config.validation[l].method&&null!==self.config.validation[l].method&&(n=self.config.validation[l].method.call(self,e,s)),(!n||"object"==typeof n&&"error"in n&&n.error)&&("undefined"!=typeof self.config.validation[l].message&&("object"==typeof n&&"tags"in n&&"object"==typeof n.tags?r.message=self.replaceCustomTags(n.tags,self.config.validation[l].message):r.message=self.config.validation[l].message),r.error=!0))}})}return r},validateRequired:function(e,r){var t=!0,n=e.attr("type"),i=e.attr("name"),l=e.val();return"undefined"!=typeof i&&(("radio"!==n||a('input[name="'+i+'"]').is(":checked"))&&("checkbox"!==n||e.is(":checked"))?l.match(/\S+/)||(t=!1):t=!1),t},validateMatch:function(e,r){var t=!0;return r&&(r=a('*[name="'+self.addSlashes(r)+'"]'),r.val()!==e.val()&&(t={},t.error=!0)),t},validateMin:function(e,a){var r=!0;return a=self.addSlashes(a),a&&e.val().length<a&&(r={},r.tags={"{min}":a},r.error=!0),r},validateMax:function(e,a){var r=!0;return a=self.addSlashes(a),a&&e.val().length>a&&(r={},r.tags={"{max}":a},r.error=!0),r},addSlashes:function(e){return(e+"").replace(/[\\\[\]"']/g,"\\$&").replace(/\u0000/g,"\\0")},replaceCustomTags:function(e,r){return a.each(e,function(e,a){r=r.replace(e,a)}),r},clearError:function(e){var r=e.attr("type"),t=e.attr("name"),n=self.getUid(e);e.attr("data-gavel","true"),e.removeClass(self.config.errorClass),self.config.errorText&&("radio"===r?a("."+self.config.errorClass+'[data-gavel-error-name="'+t+'"]').remove():a("."+self.config.errorClass+'[data-gavel-error-uid="'+n+'"]').remove())},outPutError:function(e,r){var t=(e.attr("type"),e.attr("name")),n=self.getUid(e),i=a(e.data("gavel-errorcont")),l="<"+self.config.errorContainer+' class="'+self.config.errorClass+'" data-gavel-error-uid="'+n+'" data-gavel-error-name="'+t+'">'+r+"</"+self.config.errorContainer+">";e.attr("data-gavel","false"),e.addClass(self.config.errorClass),self.config.errorText&&(i.length>0?i.append(l):e.after(l))}},r.defaults=r.prototype.defaults,a.fn.gavel=function(e){return this.each(function(){new r(this,e).init()})},e.Gavel=r}(window,jQuery);